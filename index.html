<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Notes Square ‚Äî Apple UI</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  :root{
    --bg:#f7f7fb;
    --card:#fff;
    --text:#0b1220;
    --muted:#6b7280;
    --accent1:#6a11cb;
    --accent2:#2575fc;
    --glass: rgba(255,255,255,0.6);
  }
  body.dark{
    --bg:#0b0d0f;
    --card:#0f1113;
    --text:#eaeaea;
    --muted:#9a9a9a;
  }
  body{font-family:Inter,system-ui,-apple-system,"Helvetica Neue",Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased}
  main{max-width:1100px;margin:28px auto;padding:0 18px 80px}

  header{
    height:88px; display:flex; align-items:center; justify-content:center; position:relative;
    margin:14px 18px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,252,0.9));
    box-shadow: 0 8px 30px rgba(12,14,20,0.04); color:var(--text);
  }
  .title{font-weight:700;font-size:22px;letter-spacing:.2px}
  .theme-btn{position:fixed; right:18px; top:18px; padding:10px 14px;border-radius:12px;border:1px solid rgba(0,0,0,0.06); background: #fff; cursor:pointer; display:flex; gap:8px; align-items:center}
  body.dark .theme-btn{ background:#111; border:1px solid rgba(255,255,255,0.06); color:var(--text) }

  .search-wrap{display:flex;justify-content:center;margin-top:20px}
  #searchBar{width:88%;max-width:760px;padding:12px 16px;border-radius:12px;border:1px solid rgba(0,0,0,0.06); background:var(--card); font-size:16px}

  .category{margin-top:28px}
  .category-title{font-size:18px;font-weight:700;margin:6px 0;color:var(--text)}
  .notes-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;margin-top:12px}

  .note-card{background:var(--card);padding:16px;border-radius:14px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 12px 30px rgba(2,6,23,0.04)}
  .note-card .title{font-weight:700}
  .note-card .meta{color:var(--muted);font-size:13px;margin-top:8px}

  .download-btn{display:inline-block;padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;text-decoration:none;font-weight:700;position:relative;overflow:hidden}
  .ripple{position:absolute;border-radius:50%;background:rgba(255,255,255,0.5);pointer-events:none}
  .check{position:absolute;inset:0;display:grid;place-items:center;font-weight:700;opacity:0;transition:opacity .12s}

  .skeleton-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;margin-top:12px}
  .skel{height:110px;border-radius:12px;background:linear-gradient(90deg,#ecedf1,#f7f7fb,#ecedf1);background-size:200% 100%;animation:shimmer 1.6s linear infinite}
  @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

  .cursor-ring{position:fixed;left:0;top:0;width:14px;height:14px;border-radius:50%;border:2px solid rgba(37,117,252,0.9);transform:translate(-50%,-50%);pointer-events:none;z-index:9999;mix-blend-mode: difference}
  .back-to-top{position:fixed;right:18px;bottom:24px;padding:10px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;font-weight:700;display:none}
  footer{margin-top:42px;padding:22px;text-align:center;color:var(--muted);font-size:14px}
  @media (max-width:720px){ header{height:80px} }
</style>
</head>
<body>
  <header><div class="title">üìò Notes Square</div></header>

  <button id="themeToggle" class="theme-btn"><span id="themeIcon">üåô</span><span id="themeLabel">Dark</span></button>

  <main>
    <div class="search-wrap"><input id="searchBar" placeholder="Search notes or categories..." autocomplete="off"></div>

    <div id="skeleton" class="skeleton-grid" aria-hidden="true"></div>
    <div id="contentArea" style="margin-top:12px"></div>

    <footer>Made with ‚ù§Ô∏è by Laxmi Aigali</footer>
  </main>

  <div class="cursor-ring" id="cursorRing" aria-hidden="true"></div>
  <button id="backToTop" class="back-to-top">‚Üë Top</button>

<script>
/* Shared base logic: manifest watch, search, skeleton, animations */
const contentArea = document.getElementById('contentArea');
const skeleton = document.getElementById('skeleton');
const searchBar = document.getElementById('searchBar');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const themeLabel = document.getElementById('themeLabel');
const backToTop = document.getElementById('backToTop');
const cursor = document.getElementById('cursorRing');

let lastText = "";

function showSkeleton(n=6){ skeleton.innerHTML=''; for(let i=0;i<n;i++){ const d=document.createElement('div'); d.className='skel'; skeleton.appendChild(d) } skeleton.style.display=''; contentArea.style.display='none' }
function hideSkeleton(){ skeleton.style.display='none'; contentArea.style.display='' }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }

async function fetchManifestText(){ const r = await fetch('notes/manifest.json', { cache: 'no-store' }); if(!r.ok) throw new Error('manifest not found'); return await r.text(); }

function makeCard(pdf, idx){
  const card = document.createElement('article'); card.className='note-card';
  card.dataset.name = (pdf.name||'').toLowerCase(); card.dataset.category = (pdf._category||'').toLowerCase();
  card.innerHTML = `<div class="title">${escapeHtml(pdf.name)}</div><div class="meta">Size: ${escapeHtml(pdf.size||'‚Äî')}</div>
    <div style="margin-top:12px"><a class="download-btn" href="notes/${encodeURI(pdf.file)}" download>Download<span class="check">‚úì</span></a></div>`;
  card.style.opacity=0; card.style.transition=`transform .45s ease ${idx*0.05}s, opacity .45s ${idx*0.05}s`;
  setTimeout(()=>card.style.opacity=1, 20 + idx*25);

  // hover tilt (subtle)
  card.addEventListener('mousemove', e=>{
    const r = card.getBoundingClientRect(); const cx = r.left + r.width/2; const cy = r.top + r.height/2;
    const dx = e.clientX - cx, dy = e.clientY - cy;
    card.style.transform = `rotateX(${(dy / r.height) * -4}deg) rotateY(${(dx / r.width) * 5}deg)`;
  });
  card.addEventListener('mouseleave', ()=>card.style.transform='');

  const btn = card.querySelector('.download-btn'); btn.classList.add('magnetic');
  btn.addEventListener('click', e=>{
    const rect=btn.getBoundingClientRect(); const r=document.createElement('span'); r.className='ripple'; r.style.left=(e.clientX-rect.left)+'px'; r.style.top=(e.clientY-rect.top)+'px'; r.style.width='20px'; r.style.height='20px'; btn.appendChild(r); setTimeout(()=>r.remove(),700);
    const ch = btn.querySelector('.check'); ch.style.opacity = 1; setTimeout(()=> ch.style.opacity=0,900);
  });
  return card;
}

function renderManifest(manifest){
  contentArea.innerHTML='';
  if(!manifest || Object.keys(manifest).length===0){ contentArea.innerHTML='<p style="color:var(--muted)">No notes available yet.</p>'; hideSkeleton(); return; }
  let idx = 0;
  for(const [cat, arr] of Object.entries(manifest)){
    const sec = document.createElement('section'); sec.className='category';
    const title = document.createElement('div'); title.className='category-title'; title.textContent = cat;
    sec.appendChild(title);
    const list = document.createElement('div'); list.className='notes-list';
    if(!arr || arr.length===0){ const e = document.createElement('div'); e.className='empty'; e.textContent='No notes yet.'; list.appendChild(e); }
    else { arr.forEach(pdf=>{ pdf._category = cat; const card = makeCard(pdf, idx++); list.appendChild(card) }) }
    sec.appendChild(list); contentArea.appendChild(sec);
  }
  hideSkeleton();
}

function applySearch(){ const q=(searchBar.value||'').trim().toLowerCase(); document.querySelectorAll('.note-card').forEach(c=>{ const n=c.dataset.name||'', cat=c.dataset.category||''; c.style.display = (!q || n.includes(q) || cat.includes(q)) ? '' : 'none' }) }

/* theme toggle (works both ways) */
function setDarkMode(isDark){
  if(isDark){ document.body.classList.add('dark'); themeIcon.textContent='‚òÄÔ∏è'; themeLabel.textContent='Light'; localStorage.setItem('dark','true')}
  else{ document.body.classList.remove('dark'); themeIcon.textContent='üåô'; themeLabel.textContent='Dark'; localStorage.removeItem('dark') }
}
themeToggle.addEventListener('click', ()=> setDarkMode(!(document.body.classList.contains('dark'))));
if(localStorage.getItem('dark') === 'true') setDarkMode(true);

/* cursor + magnetic */
document.addEventListener('mousemove', e=>{ cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px'; document.querySelectorAll('.magnetic').forEach(el=>{ const r = el.getBoundingClientRect(); const dx = e.clientX - (r.left + r.width/2), dy = e.clientY - (r.top + r.height/2); const dist = Math.sqrt(dx*dx + dy*dy); const max = 160; if(dist < max){ const strength = (1 - dist/max); el.style.transform = `translate(${dx*0.05*strength}px, ${dy*0.03*strength}px) scale(${1 + 0.02*strength})`; el.style.zIndex = 50; } else { el.style.transform=''; el.style.zIndex=''; } }) });
document.addEventListener('mouseleave', ()=> document.querySelectorAll('.magnetic').forEach(el=>el.style.transform=''));

window.addEventListener('scroll', ()=> backToTop.style.display = window.scrollY > 320 ? '' : 'none');
backToTop.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));

/* init + auto-refresh */
(async function init(){
  showSkeleton(6);
  try{ const t = await fetchManifestText(); lastText = t; renderManifest(JSON.parse(t)); }catch(e){ console.error(e); contentArea.innerHTML='<p style="color:var(--muted)">Failed to load notes manifest.</p>'; hideSkeleton() }
  searchBar.addEventListener('input', applySearch);
  setInterval(async ()=>{ try{ const t = await fetchManifestText(); if(t !== lastText){ lastText = t; renderManifest(JSON.parse(t)); applySearch(); } }catch(e){} }, 3000);
})();

async function fetchManifestText(){ const r = await fetch('notes/manifest.json', { cache: 'no-store' }); if(!r.ok) throw new Error('no'); return await r.text(); }
</script>
</body>
</html>
