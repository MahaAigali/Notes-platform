<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Notes Platform</title>
<style>
  /* ---------------------------
     RESET & BASE
  --------------------------- */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html,body { height:100%; }
  body {
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: #0f0f10; /* start dark for better visuals; toggled by class */
    color: #eaeaea;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
  }
  main { max-width:1100px; margin: 32px auto; padding: 0 20px 80px; }
  a { color: inherit; }

  /* ---------------------------
     THEME: Light / Dark toggles
  --------------------------- */
  :root {
    --bg: #f7f7f7;
    --text: #222;
    --muted: #777;
    --card: #fff;
    --accent1: #6a11cb;
    --accent2: #2575fc;
    --btn1: linear-gradient(135deg,#ff9966,#ff5e62);
  }
  body.dark {
    --bg: #0f0f0f;
    --text: #eaeaea;
    --muted: #9a9a9a;
    --card: #141414;
    --accent1: #6a11cb;
    --accent2: #2575fc;
    --btn1: linear-gradient(135deg,#ff5e62,#c0392b);
  }

  body { background: var(--bg); color: var(--text); transition: background .45s ease, color .45s ease; }

  /* ---------------------------
     HEADER + PARALLAX + SWEEP
  --------------------------- */
  header {
    height:88px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    border-bottom: 1px solid rgba(0,0,0,0.06);
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    background-size:300% 300%;
    animation: headerGradient 8s ease infinite;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    transform: translateY(-18px);
    opacity: 0;
  }
  header .title {
    display:flex;
    gap:12px;
    align-items:center;
    font-size:22px;
    font-weight:700;
    color:white;
    text-shadow: 0 2px 8px rgba(0,0,0,0.25);
  }
  header::after {
    content:"";
    position:absolute; inset:0;
    pointer-events:none;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.0) 30%);
    transform: translateX(-120%);
    animation: sweep 6s linear infinite;
    mix-blend-mode: overlay;
  }
  @keyframes headerGradient { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
  @keyframes sweep { 0%{transform:translateX(-120%)} 40%{transform:translateX(120%)} 100%{transform:translateX(120%)} }
  /* header parallax slight move with mouse */
  .header-parallax { transition: transform .12s linear; will-change: transform; }

  /* fade down header entrance */
  .enter-header { animation: headerDrop .6s cubic-bezier(.2,.9,.3,1) forwards; }
  @keyframes headerDrop { to { transform: translateY(0); opacity:1; } }

  /* ---------------------------
     SEARCH BAR (expand + focus)
  --------------------------- */
  .search-wrap { display:flex; justify-content:center; margin-top:22px; }
  #searchBar {
    width: 80%; max-width:700px; padding:12px 16px; border-radius:10px;
    border: 1px solid rgba(0,0,0,0.12);
    background: rgba(255,255,255,0.03);
    color: var(--text);
    transition: box-shadow .25s ease, transform .18s ease, width .25s ease, background .25s;
    outline: none;
    font-size:16px;
  }
  #searchBar:focus {
    box-shadow: 0 8px 30px rgba(100,100,255,0.12);
    transform: translateY(-3px);
    background: rgba(255,255,255,0.04);
  }
  body:not(.dark) #searchBar { background: #fff; color: var(--text); border:1px solid rgba(0,0,0,0.06); }
  body.dark #searchBar { background: #111; color: var(--text); border:1px solid rgba(255,255,255,0.04); }

  /* ---------------------------
     CATEGORY TITLE
  --------------------------- */
  .category-title {
    font-size:20px; font-weight:700; margin: 32px 0 8px 6px; color:var(--text);
    opacity:0; transform: translateX(-18px); transition: transform .45s cubic-bezier(.2,.9,.3,1), opacity .45s;
  }
  .category-title.revealed { opacity:1; transform:none; }

  /* ---------------------------
     NOTES GRID / CARDS
  --------------------------- */
  .notes-list { margin-top:8px; }
  .note-card {
    background: var(--card);
    padding: 18px;
    border-radius: 14px;
    margin: 12px 6px;
    box-shadow: 0 6px 18px rgba(2,6,23,0.15);
    transition: transform .25s cubic-bezier(.15,.9,.3,1), box-shadow .25s, filter .25s;
    transform-origin: center;
    opacity:0; transform: translateY(18px) scale(.98);
    will-change: transform, opacity;
    display:flex; flex-direction:column;
  }

  .note-card.revealed { opacity:1; transform: translateY(0) scale(1); }

  .note-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 18px 40px rgba(2,6,23,0.28);
    filter: saturate(1.03);
  }

  /* 3D tilt effect container */
  .tilt {
    perspective: 1200px;
  }
  .tilt-inner {
    transform-style: preserve-3d;
    transition: transform .15s ease, box-shadow .15s;
    will-change: transform;
  }

  .note-meta { color: var(--muted); margin-top:8px; font-size:14px; }

  /* ---------------------------
     DOWNLOAD BUTTON (ripple + check)
  --------------------------- */
  .download-btn {
    display:inline-block; padding:10px 14px; color:#fff; border-radius: 10px;
    background: var(--btn1); text-decoration:none; font-weight:700; margin-top:10px;
    position:relative; overflow:hidden;
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    transition: transform .12s ease, box-shadow .18s ease;
  }
  .download-btn:active { transform: scale(.96); }

  .ripple {
    position:absolute; left:50%; top:50%; transform: translate(-50%,-50%) scale(0);
    width:20px; height:20px; border-radius:50%; background: rgba(255,255,255,0.55);
    pointer-events:none; animation: rippleAnim .6s ease-out forwards;
  }
  @keyframes rippleAnim { to { transform: translate(-50%,-50%) scale(30); opacity:0; } }

  .download-check {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    font-size:14px; background: rgba(0,0,0,0.15); color: #fff; opacity:0; transition: opacity .2s ease;
  }

  /* ---------------------------
     FLOATING SHAPES (decorative)
  --------------------------- */
  .float-wrap { position:fixed; inset:0; pointer-events:none; z-index:0; }
  .float {
    position:absolute; width:80px; height:80px; border-radius:18px;
    background: linear-gradient(135deg, rgba(106,17,203,0.18), rgba(37,117,252,0.18));
    filter: blur(18px); opacity:0.7; animation: floaty 8s ease-in-out infinite;
  }
  .float.l1 { left:6%; top:20%; animation-delay:0s; }
  .float.l2 { right:10%; top:40%; width:120px; height:120px; animation-delay:2s; }
  @keyframes floaty {
    0% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-24px) rotate(6deg); }
    100% { transform: translateY(0) rotate(0deg); }
  }

  /* ---------------------------
     STAGGER UTILS
  --------------------------- */
  .stagger-parent { --st-index:0; }
  .stagger-child { opacity:0; transform: translateY(12px) scale(.995); }
  .stagger-child.stagger-in {
    animation: childIn .45s cubic-bezier(.2,.9,.3,1) forwards;
    animation-delay: calc(var(--st-index) * 0.08s);
  }
  @keyframes childIn { to { opacity:1; transform:none; } }

  /* ---------------------------
     CURSOR RING (magnetic)
  --------------------------- */
  .cursor-ring {
    position:fixed; left:0; top:0; width:14px; height:14px; border-radius:50%;
    border:2px solid rgba(0,150,255,0.9); transform:translate(-50%,-50%); pointer-events:none;
    transition: transform .08s linear, width .12s ease, height .12s ease, background .12s;
    z-index: 9999;
    mix-blend-mode: difference;
  }

  /* ---------------------------
     SMALL RESPONSIVE
  --------------------------- */
  @media (max-width:768px) {
    header { height:76px; font-size:18px; padding:18px; }
    .note-card { margin:10px 0; }
    main { padding: 12px; }
  }
</style>
</head>
<body>

<!-- Floating decorative shapes -->
<div class="float-wrap" aria-hidden="true">
  <div class="float l1"></div>
  <div class="float l2"></div>
</div>

<header id="siteHeader" class="header-parallax">
  <div class="title header-parallax"><span style="font-size:22px;">ðŸ“˜</span> <span>Notes Platform</span></div>
</header>

<!-- Dark Mode toggle -->
<button id="themeToggle" class="toggle-btn" style="position:fixed; right:18px; top:18px; z-index:9999;">
  ðŸŒ™ Dark Mode
</button>

<!-- Cursor ring -->
<div id="cursorRing" class="cursor-ring" aria-hidden="true"></div>

<main>
  <div class="search-wrap">
    <input id="searchBar" placeholder="Search notes or categories..." autocomplete="off" />
  </div>

  <div id="contentArea">
    <!-- categories and note cards will be injected here -->
  </div>
</main>

<script>
/* ===================================================
   Utility: fetch manifest.json (notes/manifest.json)
   =================================================== */
async function fetchManifest() {
  try {
    const res = await fetch('notes/manifest.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('manifest not found');
    return await res.json();
  } catch (err) {
    console.error(err);
    return null;
  }
}

/* ===================================================
   Render notes and attach animations / behaviors
   =================================================== */
function createNoteCard(pdf) {
  const wrapper = document.createElement('div');
  wrapper.className = 'note-card tilt';
  wrapper.innerHTML = `
    <div class="tilt-inner">
      <div style="font-weight:700; font-size:18px;">${pdf.name}</div>
      <div class="note-meta">Size: ${pdf.size || 'â€”'}</div>
      <a class="download-btn" href="notes/${pdf.file}" download>Download PDF
        <span class="download-check">âœ“</span>
      </a>
    </div>
  `;
  // attach data
  wrapper.dataset.name = pdf.name.toLowerCase();
  wrapper.dataset.category = (pdf._category || '').toLowerCase();
  // add magnetic target on btn
  const btn = wrapper.querySelector('.download-btn');
  btn.classList.add('magnetic');
  // download ripple + check on click
  btn.addEventListener('click', e => {
    // ripple
    const r = document.createElement('span');
    r.className = 'ripple';
    btn.appendChild(r);
    setTimeout(()=> r.remove(), 700);
    // show check
    const ch = btn.querySelector('.download-check');
    ch.style.opacity = '1';
    setTimeout(()=> ch.style.opacity = '0', 900);
    // allow default link behavior (download) to proceed
  });
  return wrapper;
}

/* Render manifest with stagger and reveal */
function renderManifest(manifest) {
  const container = document.getElementById('contentArea');
  container.innerHTML = '';
  if (!manifest) {
    container.innerHTML = '<p style="color:var(--muted)">No notes found.</p>';
    return;
  }

  // build DOM, stagger counters
  let stIndex = 0;
  for (const [category, arr] of Object.entries(manifest)) {
    const catTitle = document.createElement('div');
    catTitle.className = 'category-title';
    catTitle.textContent = category;
    container.appendChild(catTitle);

    const listWrap = document.createElement('div');
    listWrap.className = 'notes-list stagger-parent';
    container.appendChild(listWrap);

    if (!arr || arr.length === 0) {
      const empty = document.createElement('div');
      empty.className = 'empty';
      empty.textContent = 'No notes yet.';
      listWrap.appendChild(empty);
      continue;
    }

    arr.forEach(pdf => {
      pdf._category = category;
      const card = createNoteCard(pdf);
      // set stagger index as CSS var for child
      card.classList.add('stagger-child');
      card.style.setProperty('--st-index', stIndex);
      listWrap.appendChild(card);
      stIndex++;
    });
  }

  // trigger staggered reveal using IntersectionObserver
  setupRevealObservers();
}

/* ===================================================
   SEARCH FUNCTION
   =================================================== */
function applySearch() {
  const q = (document.getElementById('searchBar').value || '').trim().toLowerCase();
  document.querySelectorAll('.note-card').forEach(card => {
    const name = card.dataset.name || '';
    const cat = card.dataset.category || '';
    card.style.display = (!q || name.includes(q) || cat.includes(q)) ? '' : 'none';
  });
}

/* ===================================================
   STAGGER / SCROLL REVEAL (IntersectionObserver)
   =================================================== */
function setupRevealObservers() {
  const q = document.querySelectorAll('.category-title, .note-card');
  const rootMargin = '0px 0px -8% 0px';
  const obs = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const el = entry.target;
        if (el.classList.contains('category-title')) {
          el.classList.add('revealed');
        } else if (el.classList.contains('note-card')) {
          // stagger based on index: compute delay using position in DOM
          const idx = Array.from(document.querySelectorAll('.note-card')).indexOf(el);
          el.style.transition = `transform .55s cubic-bezier(.2,.9,.3,1) ${idx*0.06}s, opacity .55s ${idx*0.06}s`;
          el.classList.add('revealed');
          // attach 3D tilt handlers
          attachTilt(el);
        }
        obs.unobserve(el);
      }
    });
  }, { root: null, rootMargin, threshold: 0.06 });

  q.forEach(el => obs.observe(el));
}

/* ===================================================
   3D Tilt (mouse move) for each card
   =================================================== */
function attachTilt(card) {
  const inner = card.querySelector('.tilt-inner');
  if (!inner) return;
  function onMove(e) {
    const rect = card.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const dx = e.clientX - cx;
    const dy = e.clientY - cy;
    const rx = (dy / rect.height) * -6; // rotate X
    const ry = (dx / rect.width) * 8; // rotate Y
    inner.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateZ(8px)`;
  }
  function onLeave(){ inner.style.transform = ''; }
  card.addEventListener('mousemove', onMove);
  card.addEventListener('mouseleave', onLeave);
}

/* ===================================================
   Cursor ring + magnetic button attraction
   =================================================== */
const cursor = document.getElementById('cursorRing');
let mouseX = -100, mouseY = -100;
document.addEventListener('mousemove', e => {
  mouseX = e.clientX; mouseY = e.clientY;
  cursor.style.left = (mouseX) + 'px';
  cursor.style.top = (mouseY) + 'px';
  // magnetic effect
  document.querySelectorAll('.magnetic').forEach(el => {
    const rect = el.getBoundingClientRect();
    const distX = mouseX - (rect.left + rect.width/2);
    const distY = mouseY - (rect.top + rect.height/2);
    const dist = Math.sqrt(distX*distX + distY*distY);
    const max = 160; // radius for attraction
    if (dist < max) {
      const strength = (1 - (dist / max));
      el.style.transform = `translate(${distX * 0.08 * strength}px, ${distY * 0.06 * strength}px) scale(${1 + 0.03*strength})`;
      el.style.zIndex = 50;
    } else {
      el.style.transform = '';
      el.style.zIndex = '';
    }
  });
});

/* Reset transforms when mouse leaves window */
document.addEventListener('mouseleave', () => {
  document.querySelectorAll('.magnetic').forEach(el => el.style.transform = '');
});

/* ===================================================
   Header parallax (mouse move subtle)
   =================================================== */
const header = document.getElementById('siteHeader');
document.addEventListener('mousemove', e => {
  const w = window.innerWidth, h = window.innerHeight;
  const rx = (e.clientX - w/2) / (w/2);
  const ry = (e.clientY - h/2) / (h/2);
  header.style.transform = `translate3d(${rx*6}px, ${ry*4}px, 0)`;
});

/* ===================================================
   Floating shapes subtle opacity in dark/light
   =================================================== */
function adaptFloats() {
  document.querySelectorAll('.float').forEach(f => {
    if (document.body.classList.contains('dark')) f.style.opacity = '0.65';
    else f.style.opacity = '0.6';
  });
}

/* ===================================================
   Theme toggle (with persistence)
   =================================================== */
const themeToggle = document.getElementById('themeToggle');
function applyStoredTheme() {
  if (localStorage.getItem('dark') === 'true') {
    document.body.classList.add('dark');
    themeToggle.textContent = 'â˜€ï¸ Light Mode';
  } else {
    document.body.classList.remove('dark');
    themeToggle.textContent = 'ðŸŒ™ Dark Mode';
  }
  adaptFloats();
}
themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark');
  localStorage.setItem('dark', document.body.classList.contains('dark') ? 'true' : 'false');
  applyStoredTheme();
});

/* ===================================================
   Initialize app: fetch manifest, render, attach search
   =================================================== */
(async function init(){
  applyStoredTheme();
  // small header entrance delay
  setTimeout(()=> document.querySelector('header').classList.add('enter-header'), 60);

  const manifest = await fetchManifest();
  if (!manifest) {
    document.getElementById('contentArea').innerHTML = '<p style="color:var(--muted)">Failed to load notes manifest.</p>';
    return;
  }
  renderManifest(manifest);
  document.getElementById('searchBar').addEventListener('input', applySearch);

  // initial reveal call for elements in viewport (in case some are visible)
  setupRevealObservers();

  // remove body intro after load to keep animations crisp
  setTimeout(()=> document.body.style.opacity = 1, 400);
})();

</script>

</body>
</html>
